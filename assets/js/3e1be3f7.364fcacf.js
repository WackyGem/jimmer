"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[2339],{31536:(e,t,a)=>{a.d(t,{Z:()=>T});var n=a(80102),o=a(83117),i=a(67294),l=a(10209),r=a(59766),s=a(94780),p=a(34867);const m=(0,a(70182).ZP)();var d=a(65149),c=a(39707),u=a(66500),k=a(95408),h=a(98700),N=a(85893);const g=["component","direction","spacing","divider","children","className","useFlexGap"],b=(0,u.Z)(),y=m("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function f(e){return(0,d.Z)({props:e,name:"MuiStack",defaultTheme:b})}function v(e,t){const a=i.Children.toArray(e).filter(Boolean);return a.reduce(((e,n,o)=>(e.push(n),o<a.length-1&&e.push(i.cloneElement(t,{key:`separator-${o}`})),e)),[])}const C=({ownerState:e,theme:t})=>{let a=(0,o.Z)({display:"flex",flexDirection:"column"},(0,k.k9)({theme:t},(0,k.P$)({values:e.direction,breakpoints:t.breakpoints.values}),(e=>({flexDirection:e}))));if(e.spacing){const n=(0,h.hB)(t),o=Object.keys(t.breakpoints.values).reduce(((t,a)=>(("object"==typeof e.spacing&&null!=e.spacing[a]||"object"==typeof e.direction&&null!=e.direction[a])&&(t[a]=!0),t)),{}),i=(0,k.P$)({values:e.direction,base:o}),l=(0,k.P$)({values:e.spacing,base:o});"object"==typeof i&&Object.keys(i).forEach(((e,t,a)=>{if(!i[e]){const n=t>0?i[a[t-1]]:"column";i[e]=n}}));const s=(t,a)=>{return e.useFlexGap?{gap:(0,h.NA)(n,t)}:{"& > :not(style) ~ :not(style)":{margin:0,[`margin${o=a?i[a]:e.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[o]}`]:(0,h.NA)(n,t)}};var o};a=(0,r.Z)(a,(0,k.k9)({theme:t},l,s))}return a=(0,k.dt)(t.breakpoints,a),a};var E=a(90948),Z=a(71657);const B=function(e={}){const{createStyledComponent:t=y,useThemeProps:a=f,componentName:r="MuiStack"}=e,m=t(C),d=i.forwardRef((function(e,t){const i=a(e),d=(0,c.Z)(i),{component:u="div",direction:k="column",spacing:h=0,divider:b,children:y,className:f,useFlexGap:C=!1}=d,E=(0,n.Z)(d,g),Z={direction:k,spacing:h,useFlexGap:C},B=(0,s.Z)({root:["root"]},(e=>(0,p.Z)(r,e)),{});return(0,N.jsx)(m,(0,o.Z)({as:u,ownerState:Z,ref:t,className:(0,l.Z)(B.root,f)},E,{children:b?v(y,b):y}))}));return d}({createStyledComponent:(0,E.ZP)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root}),useThemeProps:e=>(0,Z.Z)({props:e,name:"MuiStack"})}),T=B},86153:(e,t,a)=>{a.d(t,{_:()=>x});var n=a(67294),o=a(87357),i=a(83321),l=a(61903),r=a(23599),s=a(86886),p=a(67720),m=a(90629),d=a(7906),c=a(295),u=a(53252),k=a(72882),h=a(53184),N=a(53816),g=a(24661),b=a(96540),y=a(93946),f=a(41733),v=a(50657),C=a(31425),E=a(6514),Z=a(58951),B=a(37645),T=a(52263),I=a(59457),w=a(53143);const x=(0,n.memo)((()=>{const{i18n:e}=(0,T.Z)(),t=(0,w.S)(),a=(0,n.useMemo)((()=>t?S:D),[t]),x=(0,n.useMemo)((()=>{const e=new Map;for(const t of a)e.set(t.id,t);return e}),[a]),L=(0,n.useMemo)((()=>t?O:A),[t]),j=(0,n.useMemo)((()=>{const e=new Map;for(const t of L)e.set(t.id,t);return e}),[L]),[P,q]=(0,I.x)((()=>({userId:1,province:x.get(1).province,city:x.get(1).city,address:x.get(1).address,items:[{__rowId:1,productId:1,name:j.get(1).name,quantity:2},{__rowId:2,productId:10,name:j.get(10).name,quantity:1}]}))),M=(0,n.useMemo)((()=>Math.max(...P.items.map((e=>e.__rowId)))+1),[P]),R=(0,n.useCallback)((e=>{const t=x.get(parseInt(e.target.value));void 0!==t&&q((e=>{e.userId=t.id,e.province=t.province,e.city=t.city,e.address=t.address}))}),[q,x]),U=(0,n.useCallback)((e=>{q((t=>{t.province=e.target.value}))}),[q]),F=(0,n.useCallback)((e=>{q((t=>{t.city=e.target.value}))}),[q]),K=(0,n.useCallback)((e=>{q((t=>{t.address=e.target.value}))}),[q]),z=(0,n.useCallback)(((e,t)=>{q((a=>{for(const n of a.items)if(n.__rowId===t){n.productId=parseInt(e.target.value),_(a);break}}))}),[q]),Q=(0,n.useCallback)(((e,t)=>{q((a=>{for(const n of a.items)if(n.__rowId===t){n.quantity=parseInt(e.target.value),_(a);break}}))}),[q]),G=(0,n.useCallback)((e=>{q((t=>{for(let a=t.items.length-1;a>=0;--a)if(t.items[a].__rowId===e){t.items.splice(a,1);break}}))}),[q]),H=(0,n.useCallback)((()=>{q((e=>{e.items.push({__rowId:M,quantity:1})}))}),[q,M]),[J,W]=(0,n.useState)(!1),$=(0,n.useCallback)((()=>{W(!0)}),[]),V=(0,n.useCallback)((()=>{W(!1)}),[]);return n.createElement(m.Z,{elevation:3,style:{padding:"1.5rem"}},n.createElement(o.Z,{component:"form",noValidate:!0,autoComplete:"off"},n.createElement(s.ZP,{container:!0,spacing:2},n.createElement(s.ZP,{item:!0,xs:4},n.createElement(l.Z,{fullWidth:!0,select:!0,label:t?"\u8d2d\u4e70\u4eba":"Purchaser",value:P.userId,onChange:R},a.map((e=>n.createElement(r.Z,{key:e.id,value:e.id},e.nickName))))),n.createElement(s.ZP,{item:!0,xs:4},n.createElement(l.Z,{fullWidth:!0,label:t?"\u7701\u4efd":"Province",value:P.province,onChange:U})),n.createElement(s.ZP,{item:!0,xs:4},n.createElement(l.Z,{fullWidth:!0,label:t?"\u57ce\u5e02":"City",value:P.city,onChange:F})),n.createElement(s.ZP,{item:!0,xs:12},n.createElement(l.Z,{fullWidth:!0,label:t?"\u5730\u5740":"Address",value:P.address,onChange:K})),n.createElement(s.ZP,{item:!0,xs:12},n.createElement(p.Z,{textAlign:"left"},"\u8ba2\u5355\u660e\u7ec6"),n.createElement(k.Z,{component:m.Z},n.createElement(d.Z,{size:"small"},n.createElement(h.Z,null,n.createElement(N.Z,null,n.createElement(u.Z,null,t?"\u5546\u54c1":"Commodity"),n.createElement(u.Z,null,t?"\u6570\u91cf":"Quantity"),n.createElement(u.Z,null,t?"\u5355\u4ef7":"Unit price"),n.createElement(u.Z,null,t?"\u660e\u7ec6\u4ef7":"Item price"),n.createElement(u.Z,null,t?"\u5220\u9664":"Delete"))),n.createElement(c.Z,null,P.items.map((e=>{const t=void 0!==e.productId?j.get(e.productId):void 0;return n.createElement(N.Z,{key:e.__rowId},n.createElement(u.Z,null,n.createElement(l.Z,{select:!0,value:null==t?void 0:t.id,variant:"standard",size:"small",onChange:t=>{z(t,e.__rowId)}},L.map((e=>n.createElement(r.Z,{key:e.id,value:e.id},e.name))))),n.createElement(u.Z,null,n.createElement(l.Z,{type:"number",value:e.quantity,variant:"standard",size:"small",onChange:t=>{Q(t,e.__rowId)}})),n.createElement(u.Z,null,null==t?void 0:t.price),n.createElement(u.Z,null,void 0!==t&&t.price*e.quantity),n.createElement(u.Z,null,n.createElement(y.Z,{onClick:()=>G(e.__rowId)},n.createElement(f.Z,null))))}))),n.createElement(g.Z,null,n.createElement(N.Z,null,n.createElement(u.Z,{colSpan:5},n.createElement(i.Z,{onClick:H},n.createElement(b.Z,null),t?"\u6dfb\u52a0":"Add"))))))),n.createElement(s.ZP,{item:!0,xs:12},t?"\u603b\u989d":"Total price",":",P.items.filter((e=>void 0!==e.productId&&"number"==typeof e.quantity)).map((e=>j.get(e.productId).price*e.quantity)).reduce(((e,t)=>e+t),0)),n.createElement(s.ZP,{item:!0,xs:12},n.createElement(i.Z,{variant:"contained",onClick:$},t?"\u63d0\u4ea4":"Submit")))),n.createElement(v.Z,{open:J,onClose:V},n.createElement(B.Z,null,t?"\u4fe1\u606f":"Info"),n.createElement(E.Z,null,n.createElement(Z.Z,null,t?"\u4ec5\u4f5c\u793a\u8303\uff0c\u65e0\u4efb\u4f55\u6548\u679c":"For demonstration only, without any effect")),n.createElement(C.Z,null,n.createElement(i.Z,{onClick:V},t?"\u5173\u95ed":"Close"))))})),S=[{id:1,nickName:"\u76ae\u76ae\u9c81",province:"\u56db\u5ddd",city:"\u6210\u90fd",address:"\u9f99\u6cc9\u9a7f\u533a\u6d2a\u7389\u8def\u4e0e\u5341\u6d2a\u8def\u4ea4\u53c9\u53e3"},{id:2,nickName:"\u9c81\u897f\u897f",province:"\u5e7f\u4e1c",city:"\u5e7f\u5dde",address:"\u767d\u4e91\u533a\u77f3\u6c99\u8def300\u53f7"},{id:3,nickName:"\u8212\u514b",province:"\u897f\u85cf",city:"\u62c9\u8428",address:"\u5806\u9f99\u5fb7\u5e86\u533a"},{id:4,nickName:"\u8d1d\u5854",province:"\u4e0a\u6d77",city:"\u4e0a\u6d77",address:"\u6d66\u4e1c\u65b0\u533a\u79c0\u6cbf\u897f\u8def218\u5f04"}],D=[{id:1,nickName:"Schneewittchen",province:"Berlin",city:"Prenzlauer Berg",address:"Brandenburgische Stra\xdfe 9, Prenzlauer Berg, Berlin, Germany"},{id:2,nickName:"Cinderella",province:"Basse-Normandie",city:"Lisieux",address:"20 rue L\xe9on Dierx, Lisieux, Basse-Normandie, France"},{id:3,nickName:"Nuwa",province:"ShanXi",city:"Taiyuan",address:"Qian Feng Nan Lu 99hao, Taiyuan, ShanXi, China"},{id:4,nickName:"Pinocchio",province:"Palazzo Pignano",city:"Cremona",address:"Via Giovanni Amendola 134, Palazzo Pignano, Cremona, Italy"}],O=[{id:1,name:"zippo\u591c\u5149\u6d41\u6c99\u6253\u706b\u673a",price:268},{id:2,name:"\u6770\u767b(Jayden)\u5370\u5ea6\u5854\u5e03\u62c9\u9f13",price:9238},{id:3,name:"\u6d6a\u7434(Longines)\u673a\u68b0\u624b\u8868",price:13900},{id:4,name:"viney\u7537\u58eb\u76ae\u5e26",price:139},{id:5,name:"\u96c5\u8bd7\u5170\u9edb\u7ed2\u96fe\u54d1\u5149\u5507\u818f",price:310},{id:6,name:"CIRCUIT\u7537\u5b50\u6ed1\u96ea\u5355\u677f",price:2044},{id:7,name:"\u7279\u4ed1\u82cf\u8131\u8102\u725b\u5976",price:47},{id:8,name:"\u4e50\u9ad8\u79ef\u6728\u5e03\u52a0\u8fea",price:374},{id:9,name:"\u53cc\u559c\u71c3\u6c14\u7535\u78c1\u901a\u7528\u538b\u529b\u9505",price:137},{id:10,name:"\u61a8\u61a8\u5ba0\u732b\u722c\u67b6",price:238}],A=[{id:1,name:"Timeless Vitamin C Plus E 10 Percent Ferulic Acid Serum Serum Unisex 1 oz",price:14.69},{id:2,name:"Dockers Men's Tiller Boat Shoe",price:52.41},{id:3,name:"Paxcoo 124 Skeins Embroidery Floss Cross Stitch Thread with Needles",price:29.99},{id:4,name:"Michael Kors Crossbody",price:70.6},{id:5,name:"Crocs unisex-child Classic Graphic Clog",price:34.99},{id:6,name:"Timex Time Machines Digital 35mm Watch",price:28.95},{id:7,name:"Scalex Mite & Lice Spray for Birds, 8 oz.",price:14.75},{id:8,name:"Under Armour Men's Storm Liner",price:13.03},{id:9,name:"Nike Women's Pro 3\" Training Shorts",price:35.86},{id:10,name:"Olaplex No. 4 Bond Maintenance Shampoo",price:30}];function _(e){const t=e.items,a=new Map;for(let n=0;n<t.length;n++){const e=t[n];if("number"!=typeof e.quantity)e.quantity=1;else if(e.quantity<1){t.splice(n--,1);continue}if(void 0===e.productId)continue;const o=a.get(e.productId);void 0===o?a.set(e.productId,e):(o.quantity+=e.quantity,t.splice(n--,1))}}},20036:(e,t,a)=>{a.d(t,{k:()=>b});var n=a(52263),o=a(94054),i=a(33841),l=a(23599),r=a(90629),s=a(43246),p=a(31536),m=a(61903),d=a(50657),c=a(37645),u=a(6514),k=a(31425),h=a(58951),N=a(83321),g=a(67294);const b=(0,g.memo)((()=>{const[e,t]=(0,g.useState)((()=>({name:"Learning GraphQL",edition:1,price:45,storeId:1,authorIds:[1,2]}))),a=(0,g.useCallback)((e=>{t((t=>({...t,name:e.target.value})))}),[]),b=(0,g.useCallback)((e=>{t((t=>({...t,edition:e.target.valueAsNumber})))}),[]),y=(0,g.useCallback)((e=>{t((t=>({...t,price:e.target.valueAsNumber})))}),[]),f=(0,g.useCallback)((e=>{let a;const n=e.target.value;a="string"==typeof n?parseInt(n):n,-1===a&&(a=void 0),t((e=>({...e,storeId:a})))}),[]),v=(0,g.useCallback)((e=>{let a=[];console.log(e.target.value);const n=e.target.value;a="string"==typeof n?n.split(",").map((e=>parseInt(e))):n,t((e=>({...e,authorIds:a})))}),[]),{i18n:C}=(0,n.Z)(),E=(0,g.useMemo)((()=>"zh"==C.currentLocale||"zh_cn"==C.currentLocale||"zh_CN"==C.currentLocale),[C.currentLocale]),[Z,B]=(0,g.useState)(!1),T=(0,g.useCallback)((()=>{B(!0)}),[]),I=(0,g.useCallback)((()=>{B(!1)}),[]);return g.createElement(r.Z,{elevation:3,style:{padding:"1.5rem",width:500}},g.createElement(p.Z,{spacing:2},g.createElement("h1",null,"Book Form"),g.createElement(m.Z,{label:"Name",value:e.name,onChange:a,error:""===e.name,helperText:""===e.name?"Name is required":""}),g.createElement(m.Z,{label:"Edition",type:"number",value:e.edition,onChange:b}),g.createElement(m.Z,{label:"Price",type:"number",value:e.price,onChange:y}),g.createElement(o.Z,{fullWidth:!0},g.createElement(i.Z,{id:"store-select-label"},"Store"),g.createElement(s.Z,{labelId:"store-select-label",label:"Authors",value:e.storeId,onChange:f},g.createElement(l.Z,{value:-1},"--NONE--"),g.createElement(l.Z,{value:1},"O'REILLY"),g.createElement(l.Z,{value:2},"MANNING"))),g.createElement(o.Z,{fullWidth:!0},g.createElement(i.Z,{id:"author-multi-select-label"},"Authors"),g.createElement(s.Z,{multiple:!0,labelId:"author-multi-select-label",label:"Authors",value:e.authorIds,onChange:v},g.createElement(l.Z,{value:1},"Eve Procello"),g.createElement(l.Z,{value:2},"Alex Banks"),g.createElement(l.Z,{value:3},"Dan Vanderkam"),g.createElement(l.Z,{value:4},"Boris Cherny"),g.createElement(l.Z,{value:5},"Samer Buna"))),g.createElement(o.Z,null,g.createElement(N.Z,{onClick:T,variant:"contained"},"\u63d0\u4ea4"))),g.createElement(d.Z,{open:Z,onClose:I},g.createElement(c.Z,null,E?"\u4fe1\u606f":"Info"),g.createElement(u.Z,null,g.createElement(h.Z,null,E?"\u4ec5\u4f5c\u793a\u8303\uff0c\u65e0\u4efb\u4f55\u6548\u679c":"For demonstration only, without any effect")),g.createElement(k.Z,null,g.createElement(N.Z,{onClick:I},"\u5173\u95ed"))))}))},32102:(e,t,a)=>{a.d(t,{s:()=>h});var n=a(83117),o=a(67294),i=a(42293),l=a(50657),r=a(6514),s=a(54776),p=a(10155),m=a(15861),d=a(93946),c=a(9137),u=a(61274),k=a(50594);const h=(0,o.memo)((e=>{let{open:t,fullScreen:a=!1,title:n,onClose:s,children:h}=e;const[g,b]=(0,o.useState)(a),y=(0,o.useCallback)((()=>{b((e=>!e))}),[]);return o.createElement(l.Z,{open:t,onClose:s,fullScreen:g,TransitionComponent:N,maxWidth:"md"},o.createElement(i.Z,{sx:{position:"relative"}},o.createElement(p.Z,null,o.createElement(m.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div"},n),o.createElement(d.Z,{onClick:y,style:{color:"white"}},g?o.createElement(u.Z,null):o.createElement(c.Z,null)),o.createElement(d.Z,{"aria-label":"close",onClick:s,style:{color:"white"}},o.createElement(k.Z,null)))),o.createElement(r.Z,null,h))})),N=o.forwardRef((function(e,t){return o.createElement(s.Z,(0,n.Z)({direction:"up",ref:t},e))}))},39511:(e,t,a)=>{a.d(t,{b:()=>l});var n=a(67294),o=a(83321),i=a(32102);const l=(0,n.memo)((e=>{let{buttonText:t,fullScreen:a=!1,title:l=t,children:r}=e;const[s,p]=(0,n.useState)(!1),m=(0,n.useCallback)((e=>{p(!0),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),[]),d=(0,n.useCallback)((()=>{p(!1)}),[]);return n.createElement(n.Fragment,null,n.createElement(o.Z,{"data-is-view-more-button":"true",onClick:m,variant:"outlined",size:"small"},t),n.createElement(i.s,{open:s,onClose:d,title:l,fullScreen:a},r))}))},53143:(e,t,a)=>{a.d(t,{S:()=>o});var n=a(52263);function o(){const{i18n:e}=(0,n.Z)(),t=e.currentLocale;return"zh"===t||"zh_cn"===t||"zh_CN"==t}},47232:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>N,frontMatter:()=>m,metadata:()=>c,toc:()=>k});var n=a(83117),o=(a(67294),a(3905)),i=a(65488),l=a(85162),r=a(20036),s=a(86153),p=a(39511);const m={sidebar_position:5,title:"Dissociation Operations"},d=void 0,c={unversionedId:"mutation/save-command/dissociation",id:"mutation/save-command/dissociation",title:"Dissociation Operations",description:"An important concept is involved when saving associated objects: dissociation operations.",source:"@site/docs/mutation/save-command/dissociation.mdx",sourceDirName:"mutation/save-command",slug:"/mutation/save-command/dissociation",permalink:"/jimmer/docs/mutation/save-command/dissociation",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer/tree/main/doc/docs/mutation/save-command/dissociation.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Dissociation Operations"},sidebar:"tutorialSidebar",previous:{title:"Save Associations",permalink:"/jimmer/docs/mutation/save-command/association"},next:{title:"Associated Id Checking",permalink:"/jimmer/docs/mutation/save-command/id-checking"}},u={},k=[{value:"Concept",id:"concept",level:2},{value:"Dissociating Join Table Data",id:"dissociating-join-table-data",level:2},{value:"Dissociating Child Table Data",id:"dissociating-child-table-data",level:2},{value:"Dissociation Modes",id:"dissociation-modes",level:3},{value:"Example",id:"example",level:3}],h={toc:k};function N(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"An important concept is involved when saving associated objects: dissociation operations."),(0,o.kt)("h2",{id:"concept"},"Concept"),(0,o.kt)("p",null,"Consider the following example:"),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Existing data structure in database"),(0,o.kt)("th",null,"Data structure user wants to save"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-Food\n|\n|\n|\n# highlight-next-line\n+-----Meat(Ignore child nodes)\n|\n\\-----Bread(Ignore child nodes)\n"))),(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-Food\n|\n+-----Drinks(Ignore child nodes)\n|\n|\n|\n\\-----Bread(Ignore child nodes)\n")))))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For ",(0,o.kt)("inlineCode",{parentName:"p"},"Bread"),", it exists in both old and new data structures, corresponding to update operation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For ",(0,o.kt)("inlineCode",{parentName:"p"},"Drinks"),", it does not exist in the old data structure, but exists in the new data, corresponding to INSERT operation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For ",(0,o.kt)("inlineCode",{parentName:"p"},"Meat"),", it exists in the old data structure, but does not exist in the new data, the corresponding operation is called dissociation operation."))),(0,o.kt)("p",null,"Dissociation applies to two types of data:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Join table data")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Child table data"))),(0,o.kt)("p",null,"Next, we discuss these two dissociation operations."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"To simplify the generated SQL as much as possible, let us focus on the association itself and dissociation operations in this article:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"All saved objects specify only the id property")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The save mode of the aggregated root object is explicitly specified as UPDATE_ONLY ",(0,o.kt)("em",{parentName:"p"},"(using the update method)"))))),(0,o.kt)("h2",{id:"dissociating-join-table-data"},"Dissociating Join Table Data"),(0,o.kt)("p",null,"There is a many-to-many association between the ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK")," table and the ",(0,o.kt)("inlineCode",{parentName:"p"},"AUTHOR")," table, with join table ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK_AUTHOR_MAPPING"),"."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author.books")," properties both map this many-to-many association and are mirrors of each other. Using either can demonstrate the effect. Here we choose ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors"),"."),(0,o.kt)("p",null,"First query the database to see which ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," objects id=3 ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," corresponds to: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select *  \nfrom book_author_mapping\nwhere book_id = 3;\n")),(0,o.kt)("p",null,"The query result is:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"book_id"),(0,o.kt)("th",{parentName:"tr",align:null},"author_id"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"1")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"2")))),(0,o.kt)("p",null,"Now update this ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," object:"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient.update(\n    BookDraft.$.produce(draft -> {\n        draft.setId(3L);\n        draft.addIntoAuthors(author -> author.setId(2L));\n        draft.addIntoAuthors(author -> author.setId(5L));\n    })\n);\n"))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient.update(\n    new(Book::class).by {\n        id = 3L\n        authors().addBy { id = 2L } \n        authors().addBy { id = 3L }\n    }\n)\n")))),(0,o.kt)("p",null,"The comparison of old and new data structures is:"),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Existing data structure in database"),(0,o.kt)("th",null,"Data structure user wants to save"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-Book(id=3)\n| \n# highlight-next-line\n+-----Author(id=1)\n|\n\\-----Author(id=2)\n\n\n"))),(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-Book(id=3)\n|\n|\n|\n+-----Author(id=2)\n|\n\\-----Author(id=5) \n")))))),(0,o.kt)("p",null,"This means:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author-2")," remains unchanged")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author-5")," needs to be created")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author-1")," needs to be deleted, which is the dissociation operation"))),(0,o.kt)("p",null,"Finally 3 SQL statements are generated:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Query which ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," objects ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," corresponds to"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select \n    AUTHOR_ID  \nfrom BOOK_AUTHOR_MAPPING \nwhere\n    BOOK_ID = ? /* 3 */\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Dissociation operation, detach association between ",(0,o.kt)("inlineCode",{parentName:"strong"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"strong"},"Author-1")),"  "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"/* highlight-next-line */\ndelete from BOOK_AUTHOR_MAPPING  \nwhere\n    (BOOK_ID, AUTHOR_ID) in (\n        (? /* 3 */, ? /* 1 */)\n    )\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author-5")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"insert into BOOK_AUTHOR_MAPPING(\n    BOOK_ID, AUTHOR_ID \n)\nvalues\n    (? /* 3 */, ? /* 5 */)\n")))),(0,o.kt)("h2",{id:"dissociating-child-table-data"},"Dissociating Child Table Data"),(0,o.kt)("p",null,"This operation is for one-to-many associations directly based on foreign keys."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK")," table has a foreign key field ",(0,o.kt)("inlineCode",{parentName:"p"},"STORE_ID")," pointing to the ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK_STORE")," table, forming a many-to-one relationship. This many-to-one association is mapped to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.store")," property, and the reverse one-to-many association is mapped to the ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books")," property."),(0,o.kt)("p",null,"If a parent object in the database ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)("inlineCode",{parentName:"em"},"BookStore")," in this example)")," holds some child objects ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)("inlineCode",{parentName:"em"},"Book")," in this example)"),", but the overwritten parent object is no longer expected to continue holding some child objects, it will cause those child objects to be dissociated."),(0,o.kt)("h3",{id:"dissociation-modes"},"Dissociation Modes"),(0,o.kt)("p",null,"Child object dissociation operations have three modes:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"NONE ",(0,o.kt)("em",{parentName:"p"},"(default)"),": Dissociation is not supported, operation is prevented by throwing exception ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"SET_NULL: Set foreign key of dissociated child object to null. Precondition is child object's many-to-one association property is nullable; otherwise attempt to configure this will cause exception")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"DELETE: Delete the dissociated child objects"))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Although child object dissociation is caused by a one-to-many association ",(0,o.kt)("em",{parentName:"p"},"(i.e. parent object abandoning some child objects, the one-to-many association is ",(0,o.kt)("inlineCode",{parentName:"em"},"BookStore.books")," in this example)"),", the dissociation mode is configured for the reverse many-to-one association ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)("inlineCode",{parentName:"em"},"Book.store")," in this example)"),". The purpose of this design is to maintain similarity with configuring cascade behaviors of foreign keys in database DDL. "),(0,o.kt)("p",{parentName:"admonition"},"For Jimmer, a one-to-many association must be bidirectional, so once a one-to-many association is known, its mirroring many-to-one association must also be known. So there is no problem with this design.  ")),(0,o.kt)("p",null,"There are two ways to configure the dissociation mode:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Static configuration on entity with annotation, static configuration is global.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Dynamic configuration in code, but dynamic configuration only affects the current save command. Dynamic configuration can override static configuration."))),(0,o.kt)("p",null,"Take ",(0,o.kt)("inlineCode",{parentName:"p"},"SET_NULL")," as an example:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Static configuration ",(0,o.kt)("em",{parentName:"p"},"(default configuration, for the vast majority of business uses)"),":"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"@Entity\npublic interface Book {\n\n    //highlight-next-line \n    @OnDissociate(DissociateAction.SET_NULL)  \n    @Nullable\n    @ManyToOne\n    BookStore store();\n\n    ...other code omitted...\n}\n"))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"@Entity\ninterface Book {\n\n    //highlight-next-line\n    @OnDissociate(DissociateAction.SET_NULL)\n    @ManyToOne  \n    val store: BookStore?\n\n    ...other code omitted...       \n}\n"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Runtime override ",(0,o.kt)("em",{parentName:"p"},"(only for a single save command, used by very few business cases with special needs)"),":"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient\n    .getEntities()\n    .saveCommand(book) \n    // highlight-next-line\n    .setDissociateAction(BookProps.STORE, DissociateAction.SET_NULL)\n    .execute();\n"))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient.save(book) {\n    // highlight-next-line\n    .setDissociateAction(Book::store, DissociateAction.SET_NULL) \n}\n")))))),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("p",null,"First, query the database to see which ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," objects id=2 ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," holds:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select *\nfrom BOOK  \nwhere STORE_ID = 2\n")),(0,o.kt)("p",null,"The query result is:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"ID"),(0,o.kt)("th",{parentName:"tr",align:null},"NAME"),(0,o.kt)("th",{parentName:"tr",align:null},"EDITION"),(0,o.kt)("th",{parentName:"tr",align:null},"PRICE"),(0,o.kt)("th",{parentName:"tr",align:null},"STORE_ID"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"12"),(0,o.kt)("td",{parentName:"tr",align:null},"GraphQL in Action"),(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"80.00"),(0,o.kt)("td",{parentName:"tr",align:null},"2")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"11"),(0,o.kt)("td",{parentName:"tr",align:null},"GraphQL in Action"),(0,o.kt)("td",{parentName:"tr",align:null},"2"),(0,o.kt)("td",{parentName:"tr",align:null},"81.00"),(0,o.kt)("td",{parentName:"tr",align:null},"2")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"10"),(0,o.kt)("td",{parentName:"tr",align:null},"GraphQL in Action"),(0,o.kt)("td",{parentName:"tr",align:null},"1"),(0,o.kt)("td",{parentName:"tr",align:null},"80.00"),(0,o.kt)("td",{parentName:"tr",align:null},"2")))),(0,o.kt)("p",null,"Now, update this ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," object:"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient.update(\n    BookStoreDraft.$.produce(draft -> {\n        draft.setId(2L);\n        draft.addIntoBooks(book -> book.setId(9L));\n        draft.addIntoBooks(book -> book.setId(10L)); \n    })\n);\n"))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient.update(\n    new(BookStore::class).by {\n        id = 2L\n        books().addBy { id = 9L }\n        books().addBy { id = 10L }\n    }\n)\n")))),(0,o.kt)("p",null,"The comparison of old and new data structures is:"),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Existing data structure in database"),(0,o.kt)("th",null,"Data structure user wants to save"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-BookStore(id=2) \n|\n+-----Book(id=10)\n| \n# highlight-next-line\n+-----Book(id=11)\n|\n# highlight-next-line\n\\-----Book(id=12)\n\n\n"))),(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-BookStore(id=2)\n|\n+-----Book(id=10)\n|\n|\n|\n|\n|\n\\-----Book(id=9)\n")))))),(0,o.kt)("p",null,"This means:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10")," remains unchanged")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-9")," needs to be created  ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," needs to dissociate ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12"),"."),(0,o.kt)("p",{parentName:"li"},"But the specific SQL operations are unknown, determined by the dissociation mode configuration of ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.store")," property."))),(0,o.kt)("p",null,"Different dissociation mode configurations will lead to different execution logic. Next, we discuss the three cases of ",(0,o.kt)("inlineCode",{parentName:"p"},"NONE"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"SET_NULL")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"DELETE"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"NONE")," ",(0,o.kt)("em",{parentName:"p"},"(default)"),":"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"NONE")," means dissociation is not supported, the operation is prevented by throwing an exception which causes transaction rollback. So the above code will throw an exception."),(0,o.kt)("p",{parentName:"li"},"The exception type is ",(0,o.kt)("inlineCode",{parentName:"p"},"org.babyfish.jimmer.sql.runtime.SaveException"),"."),(0,o.kt)("p",{parentName:"li"},"The exception message is:"),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},'Save error caused by the path: "',"<","root",">",'.books": Cannot dissociate child objects because the dissociation action of the many-to-one property "com.yourcompany.yourproject.model.Book.store" is not configured as "set null" or "cascade". There are two ways to resolve this issue: Decorate the many-to-one property "com.yourcompany.yourproject.model.Book.store" by @org.babyfish.jimmer.sql.OnDissociate whose argument is ',(0,o.kt)("inlineCode",{parentName:"p"},"DissociateAction.SET_NULL")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"DissociateAction.DELETE")," , or use save command's runtime configuration to override it"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"SET_NULL"),":"),(0,o.kt)("p",{parentName:"li"},"In this mode, two SQL statements are generated:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Associate ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-9")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10"),". For ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10")," this is effectively no change."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK  \nset\n    STORE_ID = ? /* 2 */ \nwhere\n    ID in (\n        ? /* 9 */, ? /* 10 */\n    )\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set foreign key of all books belonging to ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," whose id is not 9 or 10 ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)("inlineCode",{parentName:"em"},"Book-11")," and `",(0,o.kt)("inlineCode",{parentName:"em"},"Book-11")," in this example)")," to empty. "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK\nset\n    STORE_ID = null\nwhere \n    STORE_ID = ? /* 2 */\n    and \n    ID not in (\n        ? /* 9 */, ? /* 10 */\n    )\n")),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Note the ",(0,o.kt)("inlineCode",{parentName:"p"},"not")," in the SQL"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"DELETE"),":"),(0,o.kt)("p",{parentName:"li"},"In this mode, 4 SQL statements are generated:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Associate ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-9")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10"),". For ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10")," this is effectively no change."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK\nset\n    STORE_ID = ? /* 2 */\nwhere\n    ID in (\n        ? /* 9 */, ? /* 10 */  \n    )\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Query all books belonging to ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," whose id is not 9 or 10. For this example, the query result is ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11")," and `",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12"),"."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    ID\nfrom BOOK\nwhere\n    STORE_ID = ? /* 2 */\n    and\n    ID not in (\n        ? /* 9 */, ? /* 10 */\n    ) \n")),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Note the ",(0,o.kt)("inlineCode",{parentName:"p"},"not")," in the SQL"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Before deleting ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12"),", first clean up their many-to-many associations with ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"delete from BOOK_AUTHOR_MAPPING\nwhere\n    BOOK_ID in (\n        ? /* 11 */, ? /* 12 */\n    )\n")),(0,o.kt)("admonition",{parentName:"li",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," type has more other associations, Jimmer will clean them all up properly. It just means more SQL statements like this step."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Finally, safely delete ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12")," to complete the dissociation operation"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"delete from BOOK\nwhere\n    ID in (\n        ? /* 11 */, ? /* 12 */\n    )\n")))),(0,o.kt)("admonition",{parentName:"li",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"In fact, step 3 and step 4 are one entity, due to ",(0,o.kt)("a",{parentName:"p",href:"../delete-command"},"Delete Command")," to be discussed later. ")))),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This article simplifies the examples a lot, such as:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Explicitly specifying processing mode of aggregated root object as ",(0,o.kt)("inlineCode",{parentName:"p"},"UPDATE_ONLY")," ",(0,o.kt)("em",{parentName:"p"},"(calling ",(0,o.kt)("inlineCode",{parentName:"em"},"update")," instead of ",(0,o.kt)("inlineCode",{parentName:"em"},"save"),")"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"All associated objects are short associated objects with only id. In fact, you can arbitrarily change the format of associated objects, for example:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Do not specify ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," property, but specify ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," property ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)(p.b,{buttonText:"Short Association",mdxType:"ViewMore"},(0,o.kt)(r.k,{mdxType:"ShortAssociation"}))," expressed in another way)"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Specify ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," property and some properties that are neither ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," nor ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)(p.b,{buttonText:"Long Association",mdxType:"ViewMore"},(0,o.kt)(s._,{mdxType:"LongAssociation"})),")")," "))),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The concepts of short association and long association have been discussed before. If you forget, please review ",(0,o.kt)("a",{parentName:"p",href:"./association#association-types"},"Save Association"),".")))),(0,o.kt)("p",{parentName:"admonition"},"The examples are so simplified in this article just to keep the SQL generated by the save command as simple as possible for readers to quickly understand the characteristics of dissociation operations."),(0,o.kt)("p",{parentName:"admonition"},"As for associated objects of more complex formats, readers can try it themselves, or refer directly to the official examples ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/babyfish-ct/jimmer/tree/main/example/java/save-command"},"example/java/save-command")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/babyfish-ct/jimmer/tree/main/example/kotlin/save-command-kt"},"example/kotlin/save-command-kt"),". But these functionalities still exist, just with more generated SQL statements and more tedious hidden details.")))}N.isMDXComponent=!0}}]);